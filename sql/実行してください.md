# 📝 写メ日記スクレイピング機能 - 実行手順

**このファイルを見てください！**

---

## 🚀 実行するSQL

### phpMyAdminで実行

1. phpMyAdminを開く

2. 左側から **`pullcass_platform`** を選択

3. **「SQL」タブ** をクリック

4. 以下のファイルを開いて、全文をコピー:
   ```
   sql/diary_scrape_tables_FINAL.sql
   ```

5. phpMyAdminのSQLエディタに貼り付け

6. **「実行」** ボタンをクリック

7. ✅ 成功メッセージが表示されればOK

---

## ✅ 作成されるもの

### プラットフォームDB（pullcass_platform）

- ✅ `diary_posts` - 写メ日記投稿データ（全テナント共通）
- ✅ `diary_scrape_settings` - スクレイピング設定
- ✅ `diary_scrape_logs` - 実行ログ
- ✅ `tenant_features` - 機能フラグ追加

### 重要：テナントDBは不要！

**diary_postsはプラットフォームDBで一元管理されます。**

各テナントDBにテーブルを作成する必要はありません。

---

## 📁 次のステップ

### 1. アップロードディレクトリ作成

```bash
cd /Users/nasumac_mini/Desktop/pullcass/www

for i in {1..10}; do
    mkdir -p uploads/diary/$i/{thumbs,images,videos,deco}
done

chmod -R 755 uploads/diary
```

### 2. 暗号化キー生成

```bash
# KEYを生成
php -r "echo bin2hex(random_bytes(16)) . PHP_EOL;"

# IVを生成
php -r "echo bin2hex(random_bytes(8)) . PHP_EOL;"
```

### 3. .envに追加

生成したキーを`.env`ファイルに追加:

```env
DIARY_ENCRYPTION_KEY=生成したKEY
DIARY_ENCRYPTION_IV=生成したIV
```

---

## 📖 詳細手順

詳しい手順は以下を参照:

```
sql/SETUP_最終版_実行手順.md
```

---

## ❓ 質問がある場合

エラーが出たり、わからないことがあれば教えてください！

---

**まずは `sql/diary_scrape_tables_FINAL.sql` を実行してください！**
